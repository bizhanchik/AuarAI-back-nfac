# Sign in with Apple и Account Deletion - Инструкции по настройке

## Обзор изменений

Для соответствия требованиям Apple App Store Review Guidelines 4.8 и 5.1.1(v) были внесены следующие изменения:

### 1. Sign in with Apple (Guideline 4.8)
- ✅ Добавлена авторизация через Sign in with Apple
- ✅ Ограничивает сбор данных до имени и email пользователя
- ✅ Позволяет пользователям скрыть email адрес
- ✅ Не собирает данные взаимодействий для рекламы без согласия

### 2. Account Deletion (Guideline 5.1.1(v))
- ✅ Добавлена возможность полного удаления аккаунта
- ✅ Удаляет все пользовательские данные из Firebase Auth и бэкенда
- ✅ Включает подтверждающие диалоги для предотвращения случайного удаления

## Файлы изменены/добавлены

### iOS App
1. **AuthenticationService.swift** - Добавлена поддержка Sign in with Apple и удаления аккаунта
2. **AuthenticationView.swift** - Добавлена кнопка "Continue with Apple"
3. **SettingsView.swift** - Новый экран настроек с возможностью удаления аккаунта
4. **DashboardView.swift** - Добавлена навигация к экрану настроек
5. **AuarAI.entitlements** - Файл entitlements для Sign in with Apple capability

### Backend
1. **firebase_auth.py** - Добавлен эндпоинт DELETE /api/auth/delete-account
2. **crud.py** - Добавлена функция delete_user для удаления пользователя и всех связанных данных

## Настройка в Apple Developer Console

### Шаг 1: Включить Sign in with Apple
1. Войдите в [Apple Developer Console](https://developer.apple.com)
2. Перейдите в Certificates, Identifiers & Profiles
3. Выберите ваш App ID (com.auarai.bizhan)
4. В разделе Capabilities найдите "Sign In with Apple"
5. Включите эту capability
6. Сохраните изменения

### Шаг 2: Настроить Firebase для Apple Sign In
1. Войдите в [Firebase Console](https://console.firebase.google.com)
2. Выберите ваш проект
3. Перейдите в Authentication > Sign-in method
4. Включите "Apple" как провайдера
5. Добавьте ваш Bundle ID (com.auarai.bizhan)

## Тестирование

### Sign in with Apple
1. Запустите приложение на физическом устройстве (симулятор может не работать)
2. На экране авторизации нажмите "Continue with Apple"
3. Войдите с вашим Apple ID
4. Проверьте, что пользователь успешно авторизован

### Account Deletion
1. Авторизуйтесь в приложении
2. Перейдите в настройки (нажмите на аватар в правом верхнем углу)
3. Нажмите "Delete Account"
4. Подтвердите удаление в двух диалогах
5. Проверьте, что пользователь вышел из системы
6. Проверьте в Firebase Console, что пользователь удален

## Ответ для App Store Review

При повторной отправке приложения в App Store, используйте следующий ответ:

**Для Guideline 4.8:**
"Мы добавили Sign in with Apple как основной метод авторизации. Эта опция:
- Ограничивает сбор данных только именем и email пользователя
- Позволяет пользователям скрыть свой email адрес от нашего приложения
- Не собирает данные взаимодействий для рекламных целей без явного согласия пользователя
Кнопка 'Continue with Apple' находится на главном экране авторизации."

**Для Guideline 5.1.1(v):**
"Мы добавили полную функциональность удаления аккаунта. Пользователи могут:
- Перейти в Настройки (нажав на аватар в правом верхнем углу главного экрана)
- Выбрать 'Delete Account'
- Подтвердить удаление в двух диалогах безопасности
Это полностью удаляет аккаунт пользователя и все связанные данные из нашей системы."

## Дополнительные заметки

- Убедитесь, что ваш Apple Developer аккаунт имеет активную подписку
- Sign in with Apple требует физическое устройство для тестирования
- Entitlements файл уже настроен в проекте
- Бэкенд эндпоинт для удаления аккаунта защищен Firebase Auth токеном